<style>
    .gs_text {
        font-family: lora-regular;
        font-size: 14pt;
        line-height: 26pt;
        color:#6d6e71;
    }
</style>

<div id="page_banner">
    <div class="banner_wrapper">
        <h1 class="page_headline">Lost & Found</h1>
        <div class="missing_out_div">
            <p onclick="javascript:toggle_news_form()">Get the Latest<i id="fear_caret" class="fa fa-caret-down"></i></p>
            <div class="hidden_newsletter_form">
                <form style="font-size:12px" id="banner_newsletter">
                    <span>
                        <input id="banner_email" name="cm-iixuu-iixuu" type="email" required  placeholder="Email address"/>
                        <button type="submit" id="banner_submit">Subscribe</button>
                    </span>
                    <br>
                    <input id="banner_agree_terms" type="checkbox" required value="I agree to receive newsletters from The Bay Centre">
                    <label for="banner_aggree_terms" class="checkbox_lbl">I agree to receive newsletters from The Bay Centre</label>
                    <input type="hidden" name="cm-f-jhtykd" id ="banner_source" />
                    <input type="hidden" name="cm-f-jhtykh" id="banner_terms"/>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="share_this_icon_div">
    <span class='st_sharethis'></span>   
</div>

<div id="main_container">
    <div class="store_detail_content">
        <div id="mm_page_content" class="gs_text"></div>
    </div>
    <div>
        <p class="gs_text">Please complete as much of this form as possible for any lost and found items from within the Bay Centre only. You will be notified within 48 hours regarding the status of your lost and found claim.</p>
    </div>
</div>

<script>
    $(document).ready(function() {
        function renderAll(){
            var page_banner = getRepoDetailsByName('Lost & Found').images;
            var banner_url = "";
            $.each(page_banner, function(key, val){
                banner_url = val.image_url;
            });
            $("#page_banner").css({backgroundImage: "url(" + banner_url + ")"});
            
            var prefix = get_prefix();
            var pages_json = prefix + "/pages/baycentre-lost-found.json"
            $.getJSON(pages_json).done(function(data) {
                $('#mm_page_content').html(data.body);
            });
            
            var page_array = [""]
            page_array = page_array.reverse()
            full_page_array = []
            $.ajaxSetup({
                async: false
            });
            $.each( page_array , function( key, val ) {
                var pages_json = prefix+"/pages/" + val + ".json"
                $.getJSON(pages_json).then(function(data) {
                    add_to_page_array (data)
                });
            });
            $.ajaxSetup({
                async: true
            });
            
            renderPageData("#cat_stores_container","#cat_stores_template",full_page_array, "pages")
            
            $(".loading_overlay").hide();
            $("#page_content").show();
        }
        
        function add_to_page_array (data){
            full_page_array.push(data)
        }
        
        function renderPageData(container, template, collection, type){
            var item_list = [];
            var item_rendered = [];
            var template_html = $(template).html();
            Mustache.parse(template_html);   // optional, speeds up future uses
            $.each( collection , function( key, val ) {
                var title = val.title.split(" - ");
                val.title = title[1]
                
                var rendered = Mustache.render(template_html,val);
                item_rendered.push(rendered);
            });
            $(container).show();
            $(container).html(item_rendered.join(''));
        };
        
         
    // function show_stores(id){
    //   if ($("#cat_"+id+"_stores").is(":visible")){
    //       $("#cat_"+id+"_stores").slideUp();
    //       $("#icon_"+id).removeClass("fa-minus")
    //       $("#icon_"+id).addClass("fa-plus")
    //   } else {
    //       $("#cat_"+id+"_stores").slideDown();
    //       $("#icon_"+id).removeClass("fa-plus")
    //       $("#icon_"+id).addClass("fa-minus")
    //   }
    // }
    
        loadMallDataCached(renderAll); 
    })
</script>