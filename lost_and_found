<link href="//netdna.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
<style>
    .gs_text {
        font-family: lora-regular;
        font-size: 14pt;
        line-height: 26pt;
        color:#6d6e71;
    }
    .margin_30 {
        margin-bottom: 30px;
    }
</style>

<div id="page_banner">
    <div class="banner_wrapper">
        <h1 class="page_headline">Lost & Found</h1>
        <div class="missing_out_div">
            <p onclick="javascript:toggle_news_form()">Get the Latest<i id="fear_caret" class="fa fa-caret-down"></i></p>
            <div class="hidden_newsletter_form">
                <form style="font-size:12px" id="banner_newsletter">
                    <span>
                        <input id="banner_email" name="cm-iixuu-iixuu" type="email" required  placeholder="Email address"/>
                        <button type="submit" id="banner_submit">Subscribe</button>
                    </span>
                    <br>
                    <input id="banner_agree_terms" type="checkbox" required value="I agree to receive newsletters from The Bay Centre">
                    <label for="banner_aggree_terms" class="checkbox_lbl">I agree to receive newsletters from The Bay Centre</label>
                    <input type="hidden" name="cm-f-jhtykd" id ="banner_source" />
                    <input type="hidden" name="cm-f-jhtykh" id="banner_terms"/>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="share_this_icon_div">
    <span class='st_sharethis'></span>   
</div>

<div id="main_container">
    <div class="store_detail_content">
        <div id="mm_page_content" class="gs_text"></div>
    </div>
    <div>
        <p class="gs_text">Please complete as much of this form as possible for any lost and found items from within the Bay Centre only. You will be notified within 48 hours regarding the status of your lost and found claim.</p>
        <form id="security_form">
            <label for="propert_id" style="display:none">Property ID</label>
            <input id="propert_id" name="contest[property_id]" style="display:none" value="{{property_id}}" />
            <label for="contest_id" style="display:none">Contest ID</label>
            <input id="contest_id" name="contest[contest_id]" style="display:none" value="{{id}}" />
            
            <div class="row">
                <div class="col-md-6">
                    <label for="first_name">Full Name</label>  
                    <input class="form-control margin_30" id="first_name" name="contest[first_name]" type="text" required data-validation="required"/>
                </div>
                <div class="col-md-6">
                    <label for="email">Email *</label> 
                    <input class="form-control margin_30" id="email" name="contest[email]" type="email" required data-validation-regexp="^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$" data-validation-error-msg="Please enter a valid email address" data-validation="custom"/>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <label for="phone">Phone Number</label>  
                    <input class="form-control margin_30" id="phone" name="contest[phone]" type="text" required data-validation="required"/>    
                </div>
                <div class="col-md-6">
                    <label for="alt_phone">Alternate Phone Number </label>  
                    <input class="form-control margin_30" id="alt_phone" name="contest[alt_phone]" type="text" />    
                </div>
            </div>
            <div class="row">
                
            </div>
            <div class="row">
                <div class="col-md-6 margin_30">
                    <p>Was this item Lost or Found</p>
                    
                    <label for="lost">
                        Lost
                        <input type="radio" id="lost" name="drone" value="lost">
                    </label>
                    <label for="found">
                        Found
                        <input type="radio" id="found" name="drone" value="found">
                    </label>
                </div>
                <div class="col-md-6">
                    <label for="item-select">Please choose the type of item that was lost of found</label>
                    <select id="item-select" class="form-control margin_30">
                        <option value="">--Please select an option--</option>
                        <option value="cell phone">Cell Phone</option>
                        <option value="wallet">Wallet</option>
                        <option value="credit card">Credit Card</option>
                        <option value="passport">Passport or Personal ID</option>
                        <option value="clothing">Clothing</option>
                        <option value="jewelry">Jewelry</option>
                        <option value="Bottles, Cups, or Mugs">Bottles, Cups, or Mugs</option>
                        <option value="Eyewear">Eyewear</option>
                        <option value="Money or Gift Cards">Money or Gift Cards</option>
                        <option value="other">Other</option>
                    </select>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <label for="date">Date *</label>  
                    <input class="form-control margin_30" id="date" name="contest[date]" type="text" required data-validation="required"/>    
                </div>
                <div class="col-md-6">
                    <label for="time">Time *</label>  
                    <input class="form-control margin_30" id="time" name="contest[time]" type="text" required data-validation="required"/>    
                </div>
            </div>
            <div class="row ">
                <div class="col-md-12">
                    <label for="item">Describe the item in detail *</label>  
                    <textarea class="form-control margin_30" id="item" name="contest[item]" type="text" rows="4" required data-validation="required"/></textarea>
                </div>
            </div>
            <div class="row ">
                <div class="col-md-12">
                    <label for="location">Describe where the item was lost or found *</label>  
                    <textarea class="form-control margin_30" id="location" name="contest[location]" type="text" rows="4" required data-validation="required"/></textarea>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <button class="contest_btn animated_btn newsletter_btn">Submit</button>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
    $(document).ready(function() {
        function renderAll(){
            var page_banner = getRepoDetailsByName('Lost & Found').images;
            var banner_url = "";
            $.each(page_banner, function(key, val){
                banner_url = val.image_url;
            });
            $("#page_banner").css({backgroundImage: "url(" + banner_url + ")"});
            
            var prefix = get_prefix();
            var pages_json = prefix + "/pages/baycentre-lost-found.json"
            $.getJSON(pages_json).done(function(data) {
                $('#mm_page_content').html(data.body);
            });
            
            var page_array = [""]
            page_array = page_array.reverse()
            full_page_array = []
            $.ajaxSetup({
                async: false
            });
            $.each( page_array , function( key, val ) {
                var pages_json = prefix+"/pages/" + val + ".json"
                $.getJSON(pages_json).then(function(data) {
                    add_to_page_array (data)
                });
            });
            $.ajaxSetup({
                async: true
            });
            
            renderPageData("#cat_stores_container","#cat_stores_template",full_page_array, "pages")
            
            $(".loading_overlay").hide();
            $("#page_content").show();
        }
        
        function add_to_page_array (data){
            full_page_array.push(data)
        }
        
        function renderPageData(container, template, collection, type){
            var item_list = [];
            var item_rendered = [];
            var template_html = $(template).html();
            Mustache.parse(template_html);   // optional, speeds up future uses
            $.each( collection , function( key, val ) {
                var title = val.title.split(" - ");
                val.title = title[1]
                
                var rendered = Mustache.render(template_html,val);
                item_rendered.push(rendered);
            });
            $(container).show();
            $(container).html(item_rendered.join(''));
        };
        
         
    // function show_stores(id){
    //   if ($("#cat_"+id+"_stores").is(":visible")){
    //       $("#cat_"+id+"_stores").slideUp();
    //       $("#icon_"+id).removeClass("fa-minus")
    //       $("#icon_"+id).addClass("fa-plus")
    //   } else {
    //       $("#cat_"+id+"_stores").slideDown();
    //       $("#icon_"+id).removeClass("fa-plus")
    //       $("#icon_"+id).addClass("fa-minus")
    //   }
    // }
    
        loadMallDataCached(renderAll); 
    })
</script>