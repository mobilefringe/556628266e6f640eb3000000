<link href="//netdna.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
<style>
    .gs_text {
        font-family: lora-regular;
        font-size: 14pt;
        line-height: 26pt;
        color:#6d6e71;
    }
</style>

<div id="page_banner">
    <div class="banner_wrapper">
        <h1 class="page_headline">Lost & Found</h1>
        <div class="missing_out_div">
            <p onclick="javascript:toggle_news_form()">Get the Latest<i id="fear_caret" class="fa fa-caret-down"></i></p>
            <div class="hidden_newsletter_form">
                <form style="font-size:12px" id="banner_newsletter">
                    <span>
                        <input id="banner_email" name="cm-iixuu-iixuu" type="email" required  placeholder="Email address"/>
                        <button type="submit" id="banner_submit">Subscribe</button>
                    </span>
                    <br>
                    <input id="banner_agree_terms" type="checkbox" required value="I agree to receive newsletters from The Bay Centre">
                    <label for="banner_aggree_terms" class="checkbox_lbl">I agree to receive newsletters from The Bay Centre</label>
                    <input type="hidden" name="cm-f-jhtykd" id ="banner_source" />
                    <input type="hidden" name="cm-f-jhtykh" id="banner_terms"/>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="share_this_icon_div">
    <span class='st_sharethis'></span>   
</div>

<div id="main_container">
    <div class="store_detail_content">
        <div id="mm_page_content" class="gs_text"></div>
    </div>
    <div>
        <p class="gs_text">Please complete as much of this form as possible for any lost and found items from within the Bay Centre only. You will be notified within 48 hours regarding the status of your lost and found claim.</p>
        <form id="security_form">
            <label for="propert_id" style="display:none">Property ID</label>
            <input id="propert_id" name="contest[property_id]" style="display:none" value="{{property_id}}" />
            <label for="contest_id" style="display:none">Contest ID</label>
            <input id="contest_id" name="contest[contest_id]" style="display:none" value="{{id}}" />
            
            <div class="row">
                <div class="col-md-6">
                    <label for="first_name">First Name *</label>  
                    <input class="form-control margin_30" id="first_name" name="contest[first_name]" type="text" required data-validation="required" tabindex="1"/>
                </div>
                <div class="col-md-6">
                    <label for="last_name">Last Name *</label>  
                    <input class="form-control margin_30" id="last_name" name="contest[last_name]" type="text" required data-validation="required" tabindex="2"/>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <label for="phone">Phone Number* </label>  
                    <input class="form-control margin_30" id="phone" name="contest[phone]" type="text" required data-validation="required" tabindex="3"/>    
                </div>
                <div class="col-md-6">
                    <label for="email">Email *</label> 
                    <input class="form-control margin_30" id="email" name="contest[email]" type="email" required data-validation-regexp="^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$" data-validation-error-msg="Please enter a valid email address" data-validation="custom" tabindex="4"/>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">    
                    <label for="address">Address *</label>  
                    <input class="form-control margin_30" id="address" name="contest[address]" type="text" required data-validation="required" tabindex="5"/>
                </div>
            </div>
            <div class="row">
                <div class="col-md-4">
                    <label for="city">City *</label>  
                    <input class="form-control margin_30" id="city" name="contest[city]" type="text" required data-validation="required" tabindex="6"/>    
                </div>
                <div class="col-md-4">
                    <label for="province">Province *</label>  
                    <input class="form-control margin_30" id="province" name="contest[province]" type="text" placeholder="ON" value="ON" required data-validation="required" tabindex="7"/>    
                </div>
                <div class="col-md-4">
                    <label for="postal_code">Postal Code *</label>  
                    <input class="form-control margin_30" id="postal_code" name="contest[postal_code]" type="text" required data-validation="required" tabindex="8"/>
                </div>
            </div>
            <div class="row ">
                <div class="col-md-12">
                    <label for="charity">Nominated Charity Name *</label>  
                    <input class="form-control margin_30" id="charity" name="contest[charity]" type="text" required data-validation="required" tabindex="9"/>
                </div>
            </div>
            <div class="row ">
                <div class="col-md-12">
                    <label for="essay">Essay *</label>  
                    <textarea class="form-control margin_30" id="essay" name="contest[essay]" type="text" rows="8" required data-validation="required" tabindex="10"/></textarea>
                </div>
            </div>
            <div class="row ">
                <div class="col-md-12">
                    <p>Total word count: <span id="display_count">0</span> words. Words left: <span id="word_left">500</span></p>
                </div>
            </div>
            <br>
            <div class="row">
                <div class="col-md-12">
                    <label class="agree">
                        <input id="newsletter_signup" type="checkbox" name="contest[agree]" required tabindex="11"/> 
                        Yes, I have read and agree to the contest rules.
                    </label>
                    <br/><br/>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <a href="https://www.mallmaverick.com/system/site_images/photos/000/041/411/original/Give_Back_Giveaway-Rules-Regulations.pdf?1532724334" target="_blank" tabindex="12">View the Contest Rules & Regulations</a>.
                    <br/><br/>
                    <button class="contest_btn animated_btn newsletter_btn" tabindex="13">Submit</button>
                    <br/><br/>
                    <br/><br/>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
    $(document).ready(function() {
        function renderAll(){
            var page_banner = getRepoDetailsByName('Lost & Found').images;
            var banner_url = "";
            $.each(page_banner, function(key, val){
                banner_url = val.image_url;
            });
            $("#page_banner").css({backgroundImage: "url(" + banner_url + ")"});
            
            var prefix = get_prefix();
            var pages_json = prefix + "/pages/baycentre-lost-found.json"
            $.getJSON(pages_json).done(function(data) {
                $('#mm_page_content').html(data.body);
            });
            
            var page_array = [""]
            page_array = page_array.reverse()
            full_page_array = []
            $.ajaxSetup({
                async: false
            });
            $.each( page_array , function( key, val ) {
                var pages_json = prefix+"/pages/" + val + ".json"
                $.getJSON(pages_json).then(function(data) {
                    add_to_page_array (data)
                });
            });
            $.ajaxSetup({
                async: true
            });
            
            renderPageData("#cat_stores_container","#cat_stores_template",full_page_array, "pages")
            
            $(".loading_overlay").hide();
            $("#page_content").show();
        }
        
        function add_to_page_array (data){
            full_page_array.push(data)
        }
        
        function renderPageData(container, template, collection, type){
            var item_list = [];
            var item_rendered = [];
            var template_html = $(template).html();
            Mustache.parse(template_html);   // optional, speeds up future uses
            $.each( collection , function( key, val ) {
                var title = val.title.split(" - ");
                val.title = title[1]
                
                var rendered = Mustache.render(template_html,val);
                item_rendered.push(rendered);
            });
            $(container).show();
            $(container).html(item_rendered.join(''));
        };
        
         
    // function show_stores(id){
    //   if ($("#cat_"+id+"_stores").is(":visible")){
    //       $("#cat_"+id+"_stores").slideUp();
    //       $("#icon_"+id).removeClass("fa-minus")
    //       $("#icon_"+id).addClass("fa-plus")
    //   } else {
    //       $("#cat_"+id+"_stores").slideDown();
    //       $("#icon_"+id).removeClass("fa-plus")
    //       $("#icon_"+id).addClass("fa-minus")
    //   }
    // }
    
        loadMallDataCached(renderAll); 
    })
</script>