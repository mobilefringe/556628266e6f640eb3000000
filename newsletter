<style>
    .banner_wrapper {
        margin-bottom: 60px;
    }
    .store_detail_title{
        margin-bottom:20px;
    }
    .store_detail_description{
        margin-top:20px;
    }
    .store_detail_content{
        margin-bottom:0;
        border-bottom:none;
        padding-bottom:0;
    }
    .socialize_div {
        margin-top:80px;
    }
    .socialize_text{
        margin-top:5px;
        
    }
    .socialize_social_icons{
        margin-top:0;
    }
    .newsletter_row p{
        width:49%;
        display:inline-block;
        font-family:montserrat-regular;
        font-family: proxima \9;
        font-size:16px;
        color:#4d4d4f;
    }
    .newsletter_row input {
        width:90%;
        height:34px;
        font-family:montserrat-regular;
        font-family: proxima \9;
        font-size:16px;
        color:#4d4d4f;
        line-height:34px;
        margin-top:10px;
        padding-left:10px;
        
    }
    
    .newsletter_content{
        border-bottom:none;
    }
    
    #news_gender{
        height:40px;
        background:#c7c8ca;
        width:93%;
        margin-top:10px;
        font-family:montserrat-regular;
        /*font-family: proxima \9;*/
        font-size:16px;
        color:#4d4d4f;
        line-height:34px;
    }
    .news_subscribe{
        font-family:montserrat-regular;
        /*font-family: proxima \9;*/
        font-size:16px;
        text-transform:uppercase;
        height:40px;
        border:none;
        background:#c7c8ca;
        color:white;
        width:200px;
        border-radius:50px;
        margin-top:20px;
        margin-bottom:60px;
    }
    
    @media (max-width: 767px) {
        .newsletter_row p{
            width:100%;
        }    
        .checkbox_lbl{
            width:85%;
        }
        #news_gender{
            width:95%;
        }
    }
</style>

<div id="page_banner">
    <div class="banner_wrapper">
        <h1 class="page_headline">E-Newsletter</h1>
        <div class="missing_out_div">
            <p onclick="javascript:toggle_news_form()">Fear of missing out?<i id="fear_caret" class="fa fa-caret-down"></i></p>
            <div class="hidden_newsletter_form">
                <form style="font-size:12px" id="banner_newsletter">
                    <span>
                        <input id="banner_email" name="cm-iixuu-iixuu" type="email" required  placeholder="Email address"/>
                        <button type="submit" id="banner_submit">Subscribe</button>
                    </span>
                    <br>
                    <input id="banner_agree_terms" type="checkbox" required value="I agree to receive newsletters from The Bay Centre">
                    <label for="banner_aggree_terms" class="checkbox_lbl">I agree to receive newsletters from The Bay Centre</label>
                    <input type="hidden" name="cm-f-jhtykd" id ="banner_source" />
                    <input type="hidden" name="cm-f-jhtykh" id="banner_terms"/>
                </form>
            </div>
        </div>
    </div>
</div>

<div id="main_container">
    <div id="page_content"> 
        <form action="//thebaycentre.us8.list-manage.com/subscribe/post-json?u=35241b945028701ab874f8579&amp;id=850e684995&c=?" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate style="display:none">
            <!--mail chimp hidden inputs-->
            <input title="advice newsletter" class="newletter-hidden" id="mce-FNAME" name="FNAME" type="hidden" />
            <input title="advice newsletter" class="newletter-hidden" id="mce-LNAME" name="LNAME" type="hidden" />
            <input title="advice newsletter" class="newletter-hidden" id="mce-EMAIL" name="EMAIL" type="hidden" />
            <input title="advice newsletter" class="newletter-hidden" id="mce-SEX" name="SEX" type="hidden" />
            <input title="advice newsletter" class="newletter-hidden" id="mce-AGE" name="AGE" type="hidden" />
            <input title="advice newsletter" class="newletter-hidden" id="mce-POSTALCODE" name="POSTALCODE" type="hidden" />
            <input title="advice newsletter" class="newletter-hidden" id="mce-group[12657]-12657-0" name="group[12657]-12657-0" type="checkbox" />
            <!--end mail chimp hidden inputs-->
        </form>

        <div class="newsletter_content">
            <p class="store_detail_title">STAY INFORMED</p>
            
            <div class="store_detail_description">
               Don’t miss out on exclusive content and giveaways sent straight to your inbox.<br><br>
               Fields marked with an asterisk (*) are required.
            </div>
            
            <form id="newsletter_form">
                <input id="hidden_source" name="cm-f-jhtykd" type="hidden" />
                <input id="hidden_agree_text" name="cm-f-jhtykh" type="hidden" />
                <input id="full_name" name="cm-name" type="hidden" />
                <div class="newsletter_row">
                    <p>
                        <label for="first_name">First Name*</label><br />
                        <input id="first_name" type="text" required/>
                    </p>
                    <p>
                        <label for="last_name">Last Name*</label><br />
                        <input id="last_name" type="text" required/>
                    </p>
                </div>
                <div class="newsletter_row">
                    <p>
                        <label for="news_email">Email*</label><br />
                        <input id="news_email" name="cm-iixuu-iixuu" type="email" required/>
                    </p>
                    <p>
                        <label for="news_postal">Postal Code</label><br />
                        <input id="news_postal" name="cm-f-jkyulu" type="text" />
                    </p>
                </div>
                <div class="newsletter_row">
                    <p>
                        <label for="news_age">Age</label><br />
                        <input id="news_age" name="cm-f-jkyulh" type="text" />
                    </p>
                    <p>
                        <label for="news_gender">Gender</label><br />
                        <select id="news_gender" name="cm-f-jkyulk">
                            <option selected disabled>Please Select</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                        </select>
                        <!--<input id="news_gender" name="cm-f-jkyulk" type="text" />-->
                    </p>
                </div>
                
                <input id="newsletter_agree_terms" type="checkbox" required value="Yes, I consent to receive your Commercial Electronic Messages.These emails may include special retail offers, promotions, news from our merchants, upcoming events, information on the latest trends and much more.">
                <label for="newsletter_agree_terms" class="checkbox_lbl">I agree to receive newsletters from The Bay Centre via electronic messaging; and I acknowledge that I have read and understand the Privacy Terms & Conditions.</label>
                <br>
                <button class="news_subscribe" type="submit">Subscribe</button>
            </form>

            <p class="store_detail_title">privacy policy</p>
            <div class="store_detail_description">
                Your privacy is very important to us. Your personal information will be used, if requested by you, to contact you regarding future programs, contests, promotions and events by THE BAY CENTRE. It will also be used for THE BAY CENTRE's internal marketing research purposes. From time to time THE BAY CENTRE offers our members an automatic entry to our contests. We will notify you via email that you have been entered. Your personal information will remain confidential to THE BAY CENTRE. It may, however, be disclosed to any entity that acquires THE BAY CENTRE or any of its individual properties provided such entity similarly agrees to protect your privacy. We may also use third parties to process some aspect of the personal information for our use, provided that they similarly agree to protect your privacy. If you have a privacy question or concern you may contact THE BAY CENTRE in writing at the following address: THE BAY CENTRE, #2 – 1150, Douglas Street, Victoria, BC B8W 3M9.
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() {
         function renderPageData(){
            var page_banner = getRepoDetailsByName('Newsletter').images;
            var banner_url = "";
            $.each(page_banner, function(key, val){
                banner_url = val.image_url;
            });
            $("#page_banner").css({backgroundImage: "url(" + banner_url + ")"});  
            
            $(".loading_overlay").hide();
            $("#page_content").show();
         }
        loadMallDataCached(renderPageData);
    });

    email = getRequestParam("email");
    $("#news_email").val(email);
    
    $("#newsletter_form").submit(function(e){
        e.preventDefault();
        $("#hidden_agree_text").val($("#newsletter_agree_terms").attr("value"));
        $("#hidden_source").val(window.location.href)
        var full_name = $("#first_name").val() + " " + $("#last_name").val();
        $("#full_name").val(full_name);
        $.getJSON(
            "https://mobilefringe.createsend.com/t/d/s/iixuu/?callback=?",
            $(this).serialize(),
            function (data) {
                if (data.Status === 400) {
                    e.preventDefault();
                    alert("Please try again later.");
                } else {
                    // window.location.href="/thank_you"
                    submitToMailChimp();
                }
        }); 
    })

    function submitToMailChimp(){
        $("#mce-FNAME").val($('#first_name').val())
        $("#mce-LNAME").val($('#last_name').val())
        $("#mce-EMAIL").val($('#news_email').val())
        $("#mce-SEX").val($('#news_gender option:selected' ).text()) 
        $("#mce-AGE").val($('#news_age').val()) 
        $("#mce-POSTALCODE").val($('#news_postal').val());
        $("#mce-group[12657]-12657-0").prop( "checked", true );
        
        $.ajax({
            type: $("#mc-embedded-subscribe-form").attr('method'),
            url: $("#mc-embedded-subscribe-form").attr('action'),
            data: $("#mc-embedded-subscribe-form").serialize(),
            cache       : false,
            dataType    : 'json',
            contentType: "application/json; charset=utf-8",
            error: function(err) { alert("Could not connect to the registration server. Please try again later.") },
            success: function(data) {
                if (data.result != "success") {
                    window.location.href="/thank_you"
                } else {
                    window.location.href="/thank_you"
                }
            }
        });
    }   
     
    function check_email (){
        var email = $("#news_email").val();
        if( !validateEmail(email)) {
            return false
        } else {
            return true
        }
    }
    
    function validateEmail($email) {
      var emailReg = /^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;
      if( !emailReg.test( $email ) ) {
        return false;
      } else {
        return true;
      }
    }
</script>

