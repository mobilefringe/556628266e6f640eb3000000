<style>
    .store_detail_description{
        margin-top:15px;
        color:#6d6e71 !important;
        font-family:lora-regular;
        /*font-family: neuton \9;*/
        font-size:14pt;
        line-height:26pt;
    }
    .store_detail_content{
        margin-bottom:0;
        border-bottom:none;
        padding-bottom:0;
    }
    .socialize_div {
        margin-top:80px;
    }
    
    .socialize_text{
        margin-top:5px;
        
    }
    .socialize_social_icons{
        margin-top:0;
    }
    a {
        color:#6d6e71;
    }
    
    @media (max-width: 767px) {
        .hours_day, .hours_time {
            font-size:12pt;
        }    
    }
</style>

<div id="page_banner">
    <div class="banner_wrapper">
        <h1 class="page_headline"></h1>
        <div class="missing_out_div">
            <p onclick="javascript:toggle_news_form()">Fear of missing out?<i id="fear_caret" class="fa fa-caret-down"></i></p>
            <div class="hidden_newsletter_form">
                <form style="font-size:12px" id="banner_newsletter">
                    <span>
                        <input id="banner_email" name="cm-iixuu-iixuu" type="email" required  placeholder="Email address"/>
                        <button type="submit" id="banner_submit">Subscribe</button>
                    </span>
                    <br>
                    <input id="banner_agree_terms" type="checkbox" required value="I agree to receive newsletters from The Bay Centre">
                    <label for="banner_aggree_terms" class="checkbox_lbl">I agree to receive newsletters from The Bay Centre</label>
                    <input type="hidden" name="cm-f-jhtykd" id ="banner_source" />
                    <input type="hidden" name="cm-f-jhtykh" id="banner_terms"/>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="share_this_icon_div">
    <span class='st_sharethis'></span>   
</div>

<div id="main_container">
    <div id="page_content">
        <div class="store_detail_content">
            <div class="detail_left_div">
                <div id="promo_title_container">
                    <script id="promo_title_template" type="x-tmpl-mustache/text">
                        <p class="store_detail_title">{{title}}</p>
                        <div class="store_detail_description">{{{body}}}</div>
                    </script>
                </div>
            </div>
            <div class="detail_right_div">
                <div id="store_detail_right_content_container">
                    <script id="store_detail_right_content_template" type="x-tmpl-mustache/text">
                        <a href="{{page_image}}" rel="lightbox-gallery" title="{{name}}">
                            <img class="store_front" alt="photo_{{name}}" src="{{page_image}}"/>
                        </a>
                    </script>
                </div>
                <div class="hours_div">  
                    <p class="hours_title">Hours</p>
                    <div id="store_detail_hours_container">
                        <script id="store_detail_hours_template" type="x-tmpl-mustache/text">
                            <div class="hours_object">
                                <p class="hours_day">{{day}}</p>
                                <p class="hours_time">{{hour_string}}</p>
                            </div>
                        </script>    
                    </div>
                    <p class="hours_day" style="font-style:italic">Hours subject to change</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!--For more information please see https://learnjs.io/blog/2013/11/30/snapsvg-resources/-->
<script src="//cdnjs.cloudflare.com/ajax/libs/snap.svg/0.3.0/snap.svg-min.js"></script>
<script src="https://kodekloud.s3.amazonaws.com/sites/5422419e4a616d74d9030000/e1fb5e17ab727d248230fbcb51da868f/jquery.panzoom.min.js"></script>

<script>
    $(document).ready(function() {
        function renderPageData(){
            var page_banner = getRepoDetailsByName('Pages').images;
            var banner_url = "";
            $.each(page_banner, function(key, val){
                banner_url = val.photo_url_abs;
            });
            $("#page_banner").css({backgroundImage: "url(" + banner_url + ")"});  
            
            var hours = getPropertyHours();
            prop_hours = []
            $.each( hours , function( key, val ) {
                if (val.store_id == null && val.is_holiday == false){
                    prop_hours.push(val)
                }
            })
            hours = prop_hours
            renderpageHTML();
            renderData("#store_detail_hours_container","#store_detail_hours_template", hours, "store_hours")
            $.getScript("https://cdn.jsdelivr.net/slimbox/2.0.5/js/slimbox2.js");
            $('head').append('<link rel="stylesheet" href="https://cdn.jsdelivr.net/slimbox/2.0.5/css/slimbox2.css" type="text/css" media="screen" />');
            $(".loading_overlay").hide();
            $("#page_content").show();
        }
        
        function renderpageHTML(){
            var pathArray = window.location.pathname.split( '/' );
            var slug = pathArray[pathArray.length-1];
            prefix = get_prefix();
            var pages_json = prefix+"/pages/" + slug + ".json"
            $.getJSON(pages_json).done(function(data) {
                renderData("#promo_title_container", "#promo_title_template", data, "title")
                renderData("#store_detail_right_content_container", "#store_detail_right_content_template", data, "image")
            }).fail(function(jqXHR) {
                if (jqXHR.status == 404) {
                    $("#left_image").attr("src", "//codecloud.cdn.speedyrails.net/sites/556628266e6f640eb3000000/389e126f6eee4f2c99cc11b9512c8940/404_banner3.jpg");
                    $("#right_image").attr("src", "//codecloud.cdn.speedyrails.net/sites/556628266e6f640eb3000000/389e126f6eee4f2c99cc11b9512c8940/404_banner2.jpg");
                    $("#main_image").attr("src", "//codecloud.cdn.speedyrails.net/sites/556628266e6f640eb3000000/389e126f6eee4f2c99cc11b9512c8940/404_banner1.jpg");
                }
            }); 
        }
        
        
        function renderData(container, template, collection, type){
            var item_list = [];
            var item_rendered = [];
            var template_html = $(template).html();
            Mustache.parse(template_html);   // optional, speeds up future uses
            if (type !="store_hours"){
                item_list.push(collection);
                collection = []
                collection = item_list;    
            }
            $.each( collection , function( key, val ) {
                if (type == "store_hours"){
                    switch(val.day_of_week) {
                        case 0:
                            val.day = "Sunday"
                            break;
                        case 1:
                            val.day = "Monday"
                            break;
                        case 2:
                            val.day = "Tuesday"
                            break;
                        case 3:
                            val.day = "Wednesday"
                            break;
                        case 4:
                            val.day = "Thursday"
                            break;
                        case 5:
                            val.day = "Friday"
                            break;
                        case 6:
                            val.day = "Saturday"
                            break;
                    }
                    var open_time = new Date (val.open_time)
                    var close_time = new Date (val.close_time)
                    val.open_time = convert_hour(open_time);
                    val.close_time = convert_hour(close_time);
                    if (val.is_closed == true){
                        val.hour_string = "Closed"
                    } else {
                        val.hour_string = val.open_time + " - " + val.close_time
                    }
                } else {
                    if (val.title.indexOf(" - ") >= 0){
                        var title = val.title.split(" - ");
                        val.title = title[1]
                    } 
                    if(val.image_url.indexOf('missing.png') > -1 || val.image_url.length === 0){
                        val.page_image = "//codecloud.cdn.speedyrails.net/sites/5639075d6e6f647b9f020000/image/jpeg/1453749449000/TheBayCentre (1).jpg"    
                    } else {
                        val.page_image = (val.image_url);    
                    }    
                }
                var rendered = Mustache.render(template_html,val);
                item_rendered.push(rendered);
            });
            $(container).show();
            $(container).html(item_rendered.join(''));
        };
        loadMallDataCached(renderPageData);
    })
</script>